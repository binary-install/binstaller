---
title: "GoDownloader Fork Usage Guide"
date: "2025-04-17"
author: "haya14busa"
version: "0.1.0"
status: "draft"
---

# GoDownloader Fork Usage Guide

This document provides detailed instructions on how to use the GoDownloader fork to generate installation scripts for Go binaries.

## Command Line Options

```
Usage: godownloader [options]

Options:
  -r, --repo string                 Owner/name or URL of GitHub repository
  -o, --output string               Output file (default: stdout)
  -f, --file string                 Path to local GoReleaser config file
  -c, --config string               Custom path to GoReleaser config in the repository
  --require-attestation             Require GitHub attestation verification
  --skip-attestation                Skip GitHub attestation verification
  --attestation-key file            Public key file for attestation verification
  --gh-attestation-verify-flags     Additional flags to pass to gh attestation verify
  --deny-self-hosted-runners        Shorthand for --gh-attestation-verify-flags="--deny-self-hosted-runners"
  --predicate-type string           Shorthand for --gh-attestation-verify-flags="--predicate-type=<value>"
  --signer-repo string              Shorthand for --gh-attestation-verify-flags="--signer-repo=<value>"
  --cert-identity string            Shorthand for --gh-attestation-verify-flags="--cert-identity=<value>"
  --cert-identity-regex string      Shorthand for --gh-attestation-verify-flags="--cert-identity-regex=<value>"
  -v, --version                     Show version information
  -h, --help                        Show help
```

## Basic Usage Patterns

### Generate Script from GitHub Repository

The most common use case is to generate an installation script for a GitHub repository that uses GoReleaser:

```bash
godownloader --repo=owner/repo > install.sh
```

This will:
1. Fetch the GoReleaser configuration from the repository
2. Generate a shell script that can download and install the binaries
3. Output the script to stdout (which is redirected to `install.sh`)

### Generate Script from Local Config

If you have a local GoReleaser configuration file, you can use it to generate the installation script:

```bash
godownloader --file=.goreleaser.yml > install.sh
```

### Specify Custom Config Path

If the GoReleaser configuration is not in the standard location in the repository, you can specify a custom path:

```bash
godownloader --repo=owner/repo --config=build/goreleaser.yml > install.sh
```

### Output to File

Instead of redirecting stdout, you can specify an output file directly:

```bash
godownloader --repo=owner/repo --output=install.sh
```

## GitHub Attestation Verification

GitHub attestation verification is a security feature that verifies the authenticity and integrity of downloaded binaries using cryptographically signed attestations.

### Enable Attestation Verification

To enable GitHub attestation verification in the generated script:

```bash
godownloader --repo=owner/repo --require-attestation > install.sh
```

This will generate a script that verifies GitHub attestations before installing the binary.

### Specify Custom Attestation Key

If you want to use a custom public key for attestation verification:

```bash
godownloader --repo=owner/repo --attestation-key=pubkey.pem > install.sh
```

### Skip Attestation Verification

To explicitly disable attestation verification:

```bash
godownloader --repo=owner/repo --skip-attestation > install.sh
```

### Advanced Attestation Options

The GoDownloader fork supports advanced attestation verification options provided by the GitHub CLI. You can pass these options using the `--gh-attestation-verify-flags` parameter:

```bash
godownloader --repo=owner/repo --require-attestation \
  --gh-attestation-verify-flags="--deny-self-hosted-runners --cert-identity=https://github.com/owner/repo/.github/workflows/release.yml@refs/heads/main" \
  > install.sh
```

For convenience, some common flags have shorthand options:

#### Deny Self-hosted Runners

For enhanced security, you can configure the script to reject attestations from self-hosted runners:

```bash
godownloader --repo=owner/repo --require-attestation --deny-self-hosted-runners > install.sh
```

This is equivalent to:

```bash
godownloader --repo=owner/repo --require-attestation --gh-attestation-verify-flags="--deny-self-hosted-runners" > install.sh
```

#### Specify Predicate Type

To verify specific types of attestations:

```bash
godownloader --repo=owner/repo --require-attestation --predicate-type="https://slsa.dev/provenance/v1" > install.sh
```

#### Verify Attestations from Reusable Workflows

If your attestations are generated by reusable workflows:

```bash
godownloader --repo=owner/repo --require-attestation --signer-repo="actions/reusable-workflow" > install.sh
```

#### Enforce Certificate Identity

To enforce that the certificate's subject alternative name matches exactly:

```bash
godownloader --repo=owner/repo --require-attestation --cert-identity="https://github.com/owner/repo/.github/workflows/release.yml@refs/heads/main" > install.sh
```

## Using the Generated Script

### Basic Installation

Once you have generated the installation script, users can install your application with:

```bash
curl -sfL https://raw.githubusercontent.com/owner/repo/main/install.sh | sh
```

### Install Specific Version

Users can install a specific version by passing it as an argument:

```bash
curl -sfL https://raw.githubusercontent.com/owner/repo/main/install.sh | sh -s -- v1.2.3
```

### Customize Installation Directory

By default, binaries are installed to `./bin`. Users can customize this with the `-b` flag:

```bash
curl -sfL https://raw.githubusercontent.com/owner/repo/main/install.sh | sh -s -- -b /usr/local/bin
```

### Enable Debug Output

For troubleshooting, users can enable debug output with the `-d` flag:

```bash
curl -sfL https://raw.githubusercontent.com/owner/repo/main/install.sh | sh -s -- -d
```

### Attestation Verification Options

Users can control attestation verification behavior at runtime:

```bash
# Skip attestation verification
curl -sfL https://example.com/install.sh | VERIFY_ATTESTATION=false sh

# Require attestation verification
curl -sfL https://example.com/install.sh | REQUIRE_ATTESTATION=true sh

# Specify custom attestation verification flags
curl -sfL https://example.com/install.sh | GH_ATTESTATION_VERIFY_FLAGS="--deny-self-hosted-runners" sh
```

## Examples

### Example 1: Basic GitHub Repository

```bash
# Generate installation script for a GitHub repository
godownloader --repo=haya14busa/reviewdog > install.sh

# Users can install with
curl -sfL https://raw.githubusercontent.com/haya14busa/reviewdog/main/install.sh | sh
```

### Example 2: Local Config with Attestation

```bash
# Generate installation script from local config with attestation verification
godownloader --file=.goreleaser.yml --require-attestation > install.sh

# Add to repository
git add install.sh
git commit -m "Add installation script with attestation verification"
git push
```

### Example 3: Enhanced Security with Attestation

```bash
# Generate installation script with enhanced security
godownloader --repo=owner/repo --require-attestation \
  --deny-self-hosted-runners \
  --cert-identity="https://github.com/owner/repo/.github/workflows/release.yml@refs/heads/main" \
  > install.sh
```

### Example 4: CI/CD Integration

In a CI/CD pipeline, you can automatically generate and update the installation script:

```yaml
# GitHub Actions workflow example
name: Update Installation Script

on:
  push:
    paths:
      - '.goreleaser.yml'
    branches:
      - main

jobs:
  update-script:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.20'
          
      - name: Install GoDownloader
        run: go install github.com/haya14busa/godownloader@latest
        
      - name: Generate Installation Script
        run: godownloader --file=.goreleaser.yml --require-attestation --deny-self-hosted-runners > install.sh
        
      - name: Commit and Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add install.sh
          git diff --quiet && git diff --staged --quiet || git commit -m "Update installation script"
          git push
```

## GitHub CLI Attestation Verify Command

The GoDownloader fork leverages the `gh attestation verify` command from the GitHub CLI for attestation verification. This command provides comprehensive verification capabilities.

### Command Syntax

```
gh attestation verify [<file-path> | oci://<image-uri>] [--owner | --repo] [flags]
```

### Key Flags

| Flag | Description |
|------|-------------|
| `--repo string` | Repository name in the format `<owner>/<repo>` |
| `--owner string` | GitHub organization to scope attestation lookup by |
| `--predicate-type string` | Filter attestations by provided predicate type (default "https://slsa.dev/provenance/v1") |
| `--deny-self-hosted-runners` | Fail verification for attestations generated on self-hosted runners |
| `--cert-identity string` | Enforce that the certificate's subject alternative name matches the provided value exactly |
| `--cert-identity-regex string` | Enforce that the certificate's subject alternative name matches the provided regex |
| `--signer-repo string` | Repository of reusable workflow that signed attestation in the format `<owner>/<repo>` |
| `--signer-workflow string` | Workflow that signed attestation in the format `[host/]<owner>/<repo>/<path>/<to>/<workflow>` |

### Examples

```bash
# Verify an artifact linked with a repository
gh attestation verify example.bin --repo github/example

# Verify an artifact linked with an organization
gh attestation verify example.bin --owner github

# Verify an artifact and output the full verification result
gh attestation verify example.bin --owner github --format json

# Verify an artifact with enhanced security checks
gh attestation verify example.bin --repo github/example --deny-self-hosted-runners

# Verify an artifact signed with a reusable workflow
gh attestation verify example.bin --owner github --signer-repo actions/example
```

## Troubleshooting

### Script Generation Issues

If you encounter issues generating the script:

1. Check that the repository exists and is accessible
2. Verify that the GoReleaser configuration is valid
3. Try using the `--config` flag to specify the exact path to the configuration

### Installation Issues

If users encounter issues with the installation script:

1. Use the `-d` flag to enable debug output
2. Check that the binary is available for the user's platform
3. Verify that the user has the necessary permissions to install to the specified directory

### Attestation Verification Issues

If attestation verification fails:

1. Ensure that the repository has attestations enabled
2. Check that the attestation is properly signed
3. Verify that the user has the `gh` CLI tool installed (version 2.69.0 or later)
4. Check the specific error message for details on why verification failed

Common attestation verification errors:

- **No attestation found**: The repository doesn't have attestations for the release
- **Certificate identity mismatch**: The attestation was signed by a different workflow than expected
- **Self-hosted runner detected**: The attestation was generated on a self-hosted runner and `--deny-self-hosted-runners` is enabled
- **Signature verification failed**: The attestation signature is invalid or corrupted
- **GitHub CLI not installed**: The GitHub CLI is required for attestation verification

### GitHub CLI Installation

If the user doesn't have the GitHub CLI installed, they can install it following the instructions at https://cli.github.com/

For example, on macOS:

```bash
brew install gh
```

On Linux:

```bash
# Debian/Ubuntu
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
sudo apt update
sudo apt install gh

# Fedora/RHEL
sudo dnf install gh
```

## Best Practices

1. **Version Control**: Always commit the generated installation script to your repository
2. **Keep Updated**: Regenerate the script when your GoReleaser configuration changes
3. **Documentation**: Include instructions for using the script in your project's README
4. **Security**: Enable attestation verification for enhanced security
5. **Testing**: Test the script on different platforms to ensure it works correctly

### Attestation Best Practices

1. **Enable Attestations**: Configure your GitHub Actions workflow to generate attestations for your releases
2. **Use Trusted Runners**: Prefer GitHub-hosted runners over self-hosted runners for better security
3. **Verify Certificate Identity**: Use the `--cert-identity` flag to ensure attestations come from the expected workflow
4. **Require Attestations**: Use the `--require-attestation` flag to fail if attestations are missing
5. **Document Requirements**: Inform users about attestation verification and its benefits, including the requirement for GitHub CLI

## Advanced Usage

### Custom Templates

The GoDownloader fork uses templates to generate the shell scripts. Advanced users can customize these templates:

```bash
# Export the default template
godownloader --export-template > custom-template.sh

# Edit the template as needed

# Use the custom template
godownloader --repo=owner/repo --template=custom-template.sh > install.sh
```

### Integration with Other Tools

GoDownloader can be integrated with other tools in your development workflow:

- **Makefile**: Add a target to update the installation script
- **Pre-commit Hooks**: Automatically check if the script needs updating
- **Release Automation**: Generate the script as part of your release process

## Conclusion

The GoDownloader fork provides a powerful way to generate installation scripts for Go binaries, with enhanced security through GitHub attestation verification. By following this guide, you can create scripts that make it easy for users to install your applications securely.
